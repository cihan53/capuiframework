function _extends(){return _extends=Object.assign||function(a){for(var b,c=1;c<arguments.length;c++)for(var d in b=arguments[c],b)Object.prototype.hasOwnProperty.call(b,d)&&(a[d]=b[d]);return a},_extends.apply(this,arguments)}function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function _defineProperties(a,b){for(var c,d=0;d<b.length;d++)c=b[d],c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(a,c.key,c)}function _createClass(a,b,c){return b&&_defineProperties(a.prototype,b),c&&_defineProperties(a,c),a}function _possibleConstructorReturn(a,b){return b&&("object"==typeof b||"function"==typeof b)?b:_assertThisInitialized(a)}function _getPrototypeOf(a){return _getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(a){return a.__proto__||Object.getPrototypeOf(a)},_getPrototypeOf(a)}function _assertThisInitialized(a){if(void 0===a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return a}function _inherits(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function");a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,writable:!0,configurable:!0}}),b&&_setPrototypeOf(a,b)}function _setPrototypeOf(a,b){return _setPrototypeOf=Object.setPrototypeOf||function(a,b){return a.__proto__=b,a},_setPrototypeOf(a,b)}import React from"react";import{matchPath}from"react-router";import Utils from"./CAP/Utils/Utils";import StoreManager from"./StoreManager";import{Loadable,Spinner,Log,Raise,Logger}from"../index";let CapController=function(a){function b(a){var c;return _classCallCheck(this,b),c=_possibleConstructorReturn(this,_getPrototypeOf(b).call(this,a)),c._BreadCrumbStore=null,c._BreadCrumb=[],c._SecurityProvider=0,c._components={},c._urlMap=[],c._theme="Default",c._layout="Layout",c._view="index",c._controllerName=c.constructor.name,c._action="actionIndex",c._viewPath=null,c._errors=[],c.getMethods=a=>Object.getOwnPropertyNames(a).filter(b=>"function"==typeof a[b]),c.loading=a=>a.error?(Log("Loading Error:",a.error),React.createElement(React.Fragment,null,React.createElement("div",{className:"text-white bg-danger text-center"},React.createElement("div",{className:"cart card-error p-4"},React.createElement("blockquote",{className:"card-bodyquote"},React.createElement("p",null,a.error.toString())))))):a.pastDelay?React.createElement(Spinner,null):null,c.renderView=(a,d={},e=!1,f=c.controllerName)=>{if(Logger.debug(`@ThemeViewsPath/${f}/${a}`),!e){let e=Loadable({loader:()=>import(`@ThemeViewsPath/${f}/${a}`),loading:c.loading});return Logger.debug(`@ThemeViewsPath/${f}/${a}`),React.createElement(e,_extends({},d,c.props,{Controller:b}))}return React.createElement(Spinner,null)},c.renderAjax=(a,b={},d=!1,e=c.controllerName)=>{},c.render=()=>{let a=c.getMethods(_assertThisInitialized(c));Logger.debug("Controller Find action",c.controllerName+"/"+c.action);let b=a.filter(a=>a.toLocaleLowerCase()=="action"+c.action.toLocaleLowerCase());return 0<b.length?c[b[0]]({...c.getUrlParams()}):c.renderView("Page404",{action:c.action},!1,"Default")},c.addError=a=>(c._errors.push(a),console.error(a),_assertThisInitialized(c)),c.actionError=a=>React.createElement(React.Fragment,null,React.createElement("div",{className:"text-white bg-danger text-center"},React.createElement("div",{className:"cart card-error p-4"},React.createElement("blockquote",{className:"card-bodyquote"},a.errors?React.createElement("p",null,a.errors):"",React.createElement("p",null,c.errors.map(a=>a)))))),c.getUrlParams=(a=":id?")=>{const b=matchPath(c.props.location.pathname,{path:c.props.match.path+a,exact:!0,strict:!1})||{};let d=b.params||{};return Object.assign(d,Utils.queryString.parse(c.props.location.search))},c.toUrl=(a,b={})=>c.constructor._toUrl(a,b),c.toChange=(a,b={})=>c.constructor._toChange(a,b),c.init(),c}return _inherits(b,a),_createClass(b,[{key:"init",value:function init(){let b=this.props.match.params.controller||"Default",c=(this.props.match.params.action||"Index").capitalizeFirstLetter().split("-"),d="";c.forEach(a=>{d+=a.capitalizeFirstLetter()}),this._action=d,this._controllerName=b,this._components=StoreManager.get("CommonStore").getComponent(b),!Utils.isEmpty(this.urlMap)}},{key:"UNSAFE_componentWillMount",value:function UNSAFE_componentWillMount(){null!=this._BreadCrumbStore&&StoreManager.get(this._BreadCrumbStore).setItem(this.BreadCrumb)}},{key:"componentDidCatch",value:function componentDidCatch(a,b){Logger.error("MyCatch",a,b)}},{key:"componentWillReact",value:function componentWillReact(){Logger.debug("Store Change")}},{key:"BreadCrumbStore",get:function(){return this._BreadCrumbStore},set:function(a){this._BreadCrumbStore=a}},{key:"BreadCrumb",get:function(){return this._BreadCrumb},set:function(a){this._BreadCrumb=a}},{key:"SecurityProvider",get:function(){return this._SecurityProvider},set:function(a){this._SecurityProvider=a}},{key:"theme",get:function(){return this._theme},set:function(a){this._theme=a}},{key:"view",get:function(){return this._view},set:function(a){this._view=a}},{key:"controllerName",get:function(){return this._controllerName},set:function(a){this._controllerName=a}},{key:"action",get:function(){return this._action},set:function(a){this._action=a}},{key:"urlMap",get:function(){return this._urlMap},set:function(a){this._urlMap=a}},{key:"viewPath",get:function(){return this._viewPath},set:function(a){this._viewPath=a}},{key:"layout",get:function(){return this._layout},set:function(a){this._layout=a}},{key:"components",get:function(){return this._components},set:function(a){this._components=a}},{key:"errors",get:function(){return this._errors},set:function(a){this._errors.push(a)}}]),b}(React.Component);CapController.createUrl=(a,b={},c=!0)=>{let d="";Utils.isEmpty(b)||!Utils.has(b,"id")||Utils.isEmpty(b.id)||(d=b.id,delete b.id),Utils.isEmpty(b)||(d=d+"/?"+Utils.queryString.stringify(b));let e="/"+CapController.controllerName+"/"+a;return Utils.startsWith(a,"/")&&(e=a),c?"/#"+Utils.trimEnd(e,"/")+"/"+d:Utils.trimEnd(e,"/")+(Utils.startsWith(d,"/")?d:"/"+d)},CapController._toUrl=(a,b={})=>window.location=CapController.createUrl(a,b),CapController._toChange=(a,b={})=>CapController.props.history.push(CapController.createUrl(a,b,!1));export{CapController as default};